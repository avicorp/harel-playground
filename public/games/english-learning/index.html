<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×œ×•××“×™× ×× ×’×œ×™×ª! - Learn English!</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #4A90D9;
      --primary-dark: #3570B0;
      --success: #4CAF50;
      --error: #E74C3C;
      --gold: #FFD700;
      --bg: #F0F4FF;
      --card-bg: #FFFFFF;
      --text: #333;
      --text-light: #666;
      --shadow: 0 4px 15px rgba(0,0,0,0.1);
      --shadow-hover: 0 8px 25px rgba(0,0,0,0.15);
      --radius: 16px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ===== SCREENS ===== */
    .screen {
      display: none;
      width: 100%;
      min-height: 100vh;
      animation: fadeIn 0.3s ease;
    }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== HEADER ===== */
    .header {
      width: 100%;
      background: linear-gradient(135deg, var(--primary), #6C5CE7);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-title {
      font-size: 1.3em;
      font-weight: 700;
    }
    .header-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .header-btn:hover { background: rgba(255,255,255,0.35); }

    /* ===== WELCOME SCREEN ===== */
    #welcome-screen {
      justify-content: center;
      padding: 30px 20px;
      background: linear-gradient(180deg, #E8F0FE 0%, #F0F4FF 100%);
    }
    .welcome-title {
      font-size: 2.5em;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 5px;
      text-align: center;
    }
    .welcome-subtitle {
      font-size: 1.3em;
      color: var(--text-light);
      margin-bottom: 30px;
      text-align: center;
    }
    .welcome-mascot {
      font-size: 5em;
      margin-bottom: 20px;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    /* ===== TOPIC GRID ===== */
    .section-label {
      font-size: 1.2em;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 15px;
      text-align: center;
    }
    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 14px;
      width: 100%;
      max-width: 700px;
      padding: 0 10px;
      margin-bottom: 30px;
    }
    .topic-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 18px 10px;
      text-align: center;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 3px solid transparent;
      position: relative;
    }
    .topic-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }
    .topic-card.selected {
      border-color: var(--primary);
      background: #E8F0FE;
    }
    .topic-card .topic-icon {
      font-size: 2.5em;
      margin-bottom: 6px;
      display: block;
    }
    .topic-card .topic-name-he {
      font-size: 1em;
      font-weight: 700;
      color: var(--text);
    }
    .topic-card .topic-name-en {
      font-size: 0.8em;
      color: var(--text-light);
      margin-top: 2px;
    }
    .topic-card .speaker-btn-mini {
      position: absolute;
      top: 6px;
      left: 6px;
      background: none;
      border: none;
      font-size: 1.1em;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s;
    }
    .topic-card .speaker-btn-mini:hover { opacity: 1; }

    /* ===== MODE SELECT ===== */
    .mode-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      width: 100%;
      max-width: 500px;
      padding: 0 10px;
      margin-bottom: 20px;
    }
    .mode-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 3px solid transparent;
    }
    .mode-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }
    .mode-card.selected {
      border-color: var(--primary);
      background: #E8F0FE;
    }
    .mode-icon { font-size: 2em; }
    .mode-info { text-align: right; }
    .mode-name { font-size: 1.05em; font-weight: 700; }
    .mode-desc { font-size: 0.85em; color: var(--text-light); margin-top: 2px; }

    /* ===== ROUND SELECT ===== */
    .round-grid {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 25px;
    }
    .round-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 14px 24px;
      text-align: center;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      border: 3px solid transparent;
      min-width: 90px;
    }
    .round-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }
    .round-card.selected {
      border-color: var(--primary);
      background: #E8F0FE;
    }
    .round-card .round-number {
      font-size: 1.8em;
      font-weight: 800;
      color: var(--primary);
      display: block;
    }
    .round-card .round-label {
      font-size: 0.85em;
      color: var(--text-light);
      margin-top: 2px;
    }

    /* ===== ROUND BANNER ===== */
    .round-banner {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      animation: fadeIn 0.3s ease;
    }
    .round-banner-content {
      background: white;
      border-radius: 24px;
      padding: 40px 50px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: popCorrect 0.4s ease;
    }
    .round-banner-emoji { font-size: 3em; margin-bottom: 10px; }
    .round-banner-title {
      font-size: 1.8em;
      font-weight: 800;
      color: var(--primary);
    }
    .round-banner-sub {
      font-size: 1.1em;
      color: var(--text-light);
      margin-top: 5px;
    }

    /* ===== START BUTTON ===== */
    .start-btn {
      background: linear-gradient(135deg, var(--success), #45a049);
      color: white;
      border: none;
      padding: 16px 50px;
      font-size: 1.3em;
      font-weight: 700;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(76,175,80,0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }
    .start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(76,175,80,0.5);
    }
    .start-btn:disabled {
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    /* ===== GAME SCREEN ===== */
    #game-screen { padding-bottom: 30px; }

    .progress-bar-container {
      width: 100%;
      max-width: 600px;
      height: 12px;
      background: #E0E0E0;
      border-radius: 6px;
      margin: 20px auto 10px;
      overflow: hidden;
      padding: 0 20px;
    }
    .progress-bar-container .bar-wrap {
      width: 100%;
      height: 100%;
      background: #E0E0E0;
      border-radius: 6px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), #6C5CE7);
      border-radius: 6px;
      transition: width 0.4s ease;
    }
    .progress-text {
      text-align: center;
      font-size: 0.9em;
      color: var(--text-light);
      margin-bottom: 15px;
    }

    .score-display {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.1em;
      font-weight: 700;
      color: var(--gold);
    }

    /* ===== QUESTION AREA ===== */
    .question-area {
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .prompt-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px 30px;
      text-align: center;
      box-shadow: var(--shadow);
      margin-bottom: 25px;
      width: 100%;
      position: relative;
    }
    .prompt-emoji {
      font-size: 4em;
      margin-bottom: 10px;
      display: block;
    }
    .prompt-word {
      font-size: 2em;
      font-weight: 800;
    }
    .prompt-word.english { direction: ltr; }
    .prompt-word.hebrew { direction: rtl; }

    .speaker-btn {
      background: var(--primary);
      border: none;
      color: white;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 1.4em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      transition: transform 0.2s, background 0.2s;
      box-shadow: 0 3px 10px rgba(74,144,217,0.3);
    }
    .speaker-btn:hover {
      transform: scale(1.1);
      background: var(--primary-dark);
    }
    .speaker-btn:active { transform: scale(0.95); }

    /* ===== ANSWER OPTIONS ===== */
    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      width: 100%;
      max-width: 500px;
    }
    .option-btn {
      background: var(--card-bg);
      border: 3px solid #E0E0E0;
      border-radius: var(--radius);
      padding: 18px 12px;
      text-align: center;
      cursor: pointer;
      font-size: 1.15em;
      font-weight: 600;
      transition: transform 0.15s, border-color 0.15s, background 0.15s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      position: relative;
    }
    .option-btn:hover {
      border-color: var(--primary);
      transform: scale(1.03);
    }
    .option-btn .option-emoji { font-size: 1.8em; }
    .option-btn .option-text { font-size: 1em; }
    .option-btn .option-text.english { direction: ltr; }
    .option-btn .option-text.hebrew { direction: rtl; }

    .option-btn .option-speaker {
      position: absolute;
      top: 5px;
      left: 5px;
      background: none;
      border: none;
      font-size: 1em;
      cursor: pointer;
      opacity: 0.4;
      transition: opacity 0.2s;
    }
    .option-btn .option-speaker:hover { opacity: 1; }

    .option-btn.correct {
      border-color: var(--success);
      background: #E8F5E9;
      animation: popCorrect 0.4s ease;
    }
    .option-btn.wrong {
      border-color: var(--error);
      background: #FFEBEE;
      animation: shake 0.4s ease;
    }

    @keyframes popCorrect {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    /* ===== FEEDBACK ===== */
    .feedback {
      margin-top: 20px;
      padding: 14px 24px;
      border-radius: 12px;
      font-size: 1.2em;
      font-weight: 700;
      text-align: center;
      animation: fadeIn 0.3s ease;
    }
    .feedback.correct {
      background: #E8F5E9;
      color: var(--success);
    }
    .feedback.wrong {
      background: #FFEBEE;
      color: var(--error);
    }

    /* ===== RESULTS SCREEN ===== */
    #results-screen {
      justify-content: center;
      padding: 30px 20px;
    }
    .results-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 35px 30px;
      text-align: center;
      box-shadow: var(--shadow);
      max-width: 450px;
      width: 100%;
    }
    .results-emoji { font-size: 4em; margin-bottom: 10px; }
    .results-title { font-size: 1.8em; font-weight: 800; margin-bottom: 5px; }
    .results-subtitle { font-size: 1.1em; color: var(--text-light); margin-bottom: 20px; }
    .results-stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 25px;
    }
    .stat { text-align: center; }
    .stat-value {
      font-size: 2.2em;
      font-weight: 800;
      color: var(--primary);
    }
    .stat-label {
      font-size: 0.85em;
      color: var(--text-light);
    }

    .stars-container {
      margin: 15px 0 20px;
      font-size: 2.5em;
    }
    .star { opacity: 0.2; transition: opacity 0.3s; }
    .star.earned { opacity: 1; animation: starPop 0.4s ease; }
    @keyframes starPop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); opacity: 1; }
    }

    .results-btns {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .results-btn {
      padding: 12px 28px;
      border: none;
      border-radius: 50px;
      font-size: 1.05em;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .results-btn:hover { transform: scale(1.05); }
    .results-btn.primary-btn {
      background: linear-gradient(135deg, var(--primary), #6C5CE7);
      color: white;
    }
    .results-btn.secondary-btn {
      background: #E0E0E0;
      color: var(--text);
    }

    /* ===== CONFETTI ===== */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      top: -10px;
      animation: confettiFall 3s ease-in forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 480px) {
      .welcome-title { font-size: 1.8em; }
      .welcome-mascot { font-size: 3.5em; }
      .topic-grid { grid-template-columns: repeat(2, 1fr); }
      .options-grid { grid-template-columns: 1fr 1fr; }
      .prompt-emoji { font-size: 3em; }
      .prompt-word { font-size: 1.5em; }
      .option-btn { padding: 14px 8px; font-size: 1em; }
    }

    @media (min-width: 768px) {
      .topic-grid { grid-template-columns: repeat(5, 1fr); }
    }
  </style>
</head>
<body>

<!-- ==================== WELCOME SCREEN ==================== -->
<div id="welcome-screen" class="screen active">
  <div class="welcome-mascot">ğŸ“š</div>
  <div class="welcome-title">!×œ×•××“×™× ×× ×’×œ×™×ª</div>
  <div class="welcome-subtitle">Learn English Words!</div>

  <div class="section-label">×‘×—×¨ × ×•×©× ğŸ“Œ</div>
  <div class="topic-grid" id="topic-grid"></div>

  <div class="section-label">×‘×—×¨ ×¡×•×’ ××©×—×§ ğŸ®</div>
  <div class="mode-grid" id="mode-grid"></div>

  <div class="section-label">×›××” ×¡×™×‘×•×‘×™×? ğŸ”„</div>
  <div class="round-grid" id="round-grid"></div>

  <button class="start-btn" id="start-btn" disabled onclick="startGame()">!×™××œ×œ×” × ×ª×—×™×œ ğŸš€</button>
</div>

<!-- ==================== GAME SCREEN ==================== -->
<div id="game-screen" class="screen">
  <div class="header">
    <button class="header-btn" onclick="goHome()">ğŸ  ×—×–×¨×”</button>
    <div class="header-title" id="game-header-title"></div>
    <div class="score-display">â­ <span id="score">0</span></div>
  </div>

  <div class="progress-text" id="round-text" style="margin-top:10px; font-weight:700; color:var(--primary);"></div>
  <div class="progress-bar-container">
    <div class="bar-wrap">
      <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
    </div>
  </div>
  <div class="progress-text" id="progress-text"></div>

  <div class="question-area" id="question-area"></div>
</div>

<!-- ==================== RESULTS SCREEN ==================== -->
<div id="results-screen" class="screen">
  <div class="results-card">
    <div class="results-emoji" id="results-emoji">ğŸ‰</div>
    <div class="results-title" id="results-title">!×›×œ ×”×›×‘×•×“</div>
    <div class="results-subtitle" id="results-subtitle">×¡×™×™××ª ××ª ×”××©×—×§</div>

    <div class="stars-container" id="stars-container"></div>

    <div class="results-stats">
      <div class="stat">
        <div class="stat-value" id="stat-correct">0</div>
        <div class="stat-label">×ª×©×•×‘×•×ª × ×›×•× ×•×ª</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="stat-total">0</div>
        <div class="stat-label">×©××œ×•×ª</div>
      </div>
    </div>

    <div class="results-btns">
      <button class="results-btn primary-btn" onclick="replayGame()">ğŸ”„ ×©×—×§ ×©×•×‘</button>
      <button class="results-btn secondary-btn" onclick="goHome()">ğŸ  ×—×–×¨×”</button>
    </div>
  </div>
</div>

<!-- ==================== CONFETTI ==================== -->
<div class="confetti-container" id="confetti-container"></div>

<script>
// ============================================================
//  WORD DATA - 5 topics, each with emoji, english, hebrew
// ============================================================
const TOPICS = [
  {
    id: "fruits-vegetables",
    nameHe: "×¤×™×¨×•×ª ×•×™×¨×§×•×ª",
    nameEn: "Fruits & Vegetables",
    icon: "ğŸ",
    words: [
      { emoji: "ğŸ", en: "Apple", he: "×ª×¤×•×—" },
      { emoji: "ğŸŒ", en: "Banana", he: "×‘× × ×”" },
      { emoji: "ğŸŠ", en: "Orange", he: "×ª×¤×•×–" },
      { emoji: "ğŸ‡", en: "Grapes", he: "×¢× ×‘×™×" },
      { emoji: "ğŸ“", en: "Strawberry", he: "×ª×•×ª" },
      { emoji: "ğŸ‰", en: "Watermelon", he: "××‘×˜×™×—" },
      { emoji: "ğŸ‹", en: "Lemon", he: "×œ×™××•×Ÿ" },
      { emoji: "ğŸ‘", en: "Peach", he: "××¤×¨×¡×§" },
      { emoji: "ğŸ¥•", en: "Carrot", he: "×’×–×¨" },
      { emoji: "ğŸ¥’", en: "Cucumber", he: "××œ×¤×¤×•×Ÿ" },
      { emoji: "ğŸ…", en: "Tomato", he: "×¢×’×‘× ×™×™×”" },
      { emoji: "ğŸ¥¦", en: "Broccoli", he: "×‘×¨×•×§×•×œ×™" },
      { emoji: "ğŸŒ½", en: "Corn", he: "×ª×™×¨×¡" },
      { emoji: "ğŸ¥”", en: "Potato", he: "×ª×¤×•×— ××“××”" },
      { emoji: "ğŸ§…", en: "Onion", he: "×‘×¦×œ" },
    ]
  },
  {
    id: "general-foods",
    nameHe: "××•×›×œ",
    nameEn: "General Foods",
    icon: "ğŸ•",
    words: [
      { emoji: "ğŸ•", en: "Pizza", he: "×¤×™×¦×”" },
      { emoji: "ğŸ”", en: "Hamburger", he: "×”××‘×•×¨×’×¨" },
      { emoji: "ğŸŒ­", en: "Hot Dog", he: "× ×§× ×™×§×™×™×”" },
      { emoji: "ğŸ", en: "Bread", he: "×œ×—×" },
      { emoji: "ğŸ§€", en: "Cheese", he: "×’×‘×™× ×”" },
      { emoji: "ğŸ¥š", en: "Egg", he: "×‘×™×¦×”" },
      { emoji: "ğŸš", en: "Rice", he: "××•×¨×–" },
      { emoji: "ğŸ", en: "Pasta", he: "×¤×¡×˜×”" },
      { emoji: "ğŸ¦", en: "Ice Cream", he: "×’×œ×™×“×”" },
      { emoji: "ğŸª", en: "Cookie", he: "×¢×•×’×™×™×”" },
      { emoji: "ğŸ°", en: "Cake", he: "×¢×•×’×”" },
      { emoji: "ğŸ«", en: "Chocolate", he: "×©×•×§×•×œ×“" },
      { emoji: "ğŸ¥›", en: "Milk", he: "×—×œ×‘" },
      { emoji: "ğŸ§ƒ", en: "Juice", he: "××™×¥" },
      { emoji: "ğŸ’§", en: "Water", he: "××™×" },
    ]
  },
  {
    id: "house",
    nameHe: "×‘×™×ª",
    nameEn: "House",
    icon: "ğŸ ",
    words: [
      { emoji: "ğŸšª", en: "Door", he: "×“×œ×ª" },
      { emoji: "ğŸªŸ", en: "Window", he: "×—×œ×•×Ÿ" },
      { emoji: "ğŸ›ï¸", en: "Bed", he: "××™×˜×”" },
      { emoji: "ğŸª‘", en: "Chair", he: "×›×™×¡×" },
      { emoji: "ğŸ›‹ï¸", en: "Sofa", he: "×¡×¤×”" },
      { emoji: "ğŸ“º", en: "Television", he: "×˜×œ×•×•×™×–×™×”" },
      { emoji: "ğŸª¥", en: "Toothbrush", he: "××‘×¨×©×ª ×©×™× ×™×™×" },
      { emoji: "ğŸ›", en: "Bathtub", he: "×××‘×˜×™×”" },
      { emoji: "ğŸ’¡", en: "Light", he: "××•×¨" },
      { emoji: "ğŸª", en: "Mirror", he: "××¨××”" },
      { emoji: "ğŸ§¸", en: "Teddy Bear", he: "×“×•×‘×™" },
      { emoji: "ğŸ“–", en: "Book", he: "×¡×¤×¨" },
      { emoji: "â°", en: "Clock", he: "×©×¢×•×Ÿ" },
      { emoji: "ğŸ–¥ï¸", en: "Computer", he: "××—×©×‘" },
      { emoji: "ğŸ”‘", en: "Key", he: "××¤×ª×—" },
    ]
  },
  {
    id: "playground",
    nameHe: "×’×Ÿ ××©×—×§×™×",
    nameEn: "Playground",
    icon: "ğŸ¡",
    words: [
      { emoji: "âš½", en: "Ball", he: "×›×“×•×¨" },
      { emoji: "ğŸš²", en: "Bicycle", he: "××•×¤× ×™×™×" },
      { emoji: "ğŸ›", en: "Slide", he: "××’×œ×©×”" },
      { emoji: "ğŸ¡", en: "Ferris Wheel", he: "×’×œ×’×œ ×¢× ×§" },
      { emoji: "ğŸª", en: "Kite", he: "×¢×¤×™×¤×•×Ÿ" },
      { emoji: "ğŸ§©", en: "Puzzle", he: "×¤××–×œ" },
      { emoji: "ğŸ¨", en: "Paint", he: "×¦×‘×¢" },
      { emoji: "ğŸ–ï¸", en: "Crayon", he: "×¦×‘×¢ ×©×¢×•×•×”" },
      { emoji: "ğŸª£", en: "Bucket", he: "×“×œ×™" },
      { emoji: "ğŸƒ", en: "Running", he: "×¨×™×¦×”" },
      { emoji: "ğŸ¤¸", en: "Gymnastics", he: "×”×ª×¢××œ×•×ª" },
      { emoji: "ğŸ¯", en: "Target", he: "××˜×¨×”" },
      { emoji: "ğŸˆ", en: "Balloon", he: "×‘×œ×•×Ÿ" },
      { emoji: "ğŸª€", en: "Yo-Yo", he: "×™×•×™×•" },
      { emoji: "ğŸ ", en: "Carousel", he: "×§×¨×•×¡×œ×”" },
    ]
  },
  {
    id: "transportation",
    nameHe: "×ª×—×‘×•×¨×”",
    nameEn: "Transportation",
    icon: "ğŸš—",
    words: [
      { emoji: "ğŸš—", en: "Car", he: "××›×•× ×™×ª" },
      { emoji: "ğŸšŒ", en: "Bus", he: "××•×˜×•×‘×•×¡" },
      { emoji: "ğŸš‚", en: "Train", he: "×¨×›×‘×ª" },
      { emoji: "âœˆï¸", en: "Airplane", he: "××˜×•×¡" },
      { emoji: "ğŸš¢", en: "Ship", he: "×¡×¤×™× ×”" },
      { emoji: "ğŸš", en: "Helicopter", he: "××¡×•×§" },
      { emoji: "ğŸš€", en: "Rocket", he: "×˜×™×œ" },
      { emoji: "ğŸ›µ", en: "Scooter", he: "×§×˜× ×•×¢" },
      { emoji: "ğŸš’", en: "Fire Truck", he: "×›×‘××™×ª" },
      { emoji: "ğŸš‘", en: "Ambulance", he: "×××‘×•×œ× ×¡" },
      { emoji: "ğŸš“", en: "Police Car", he: "× ×™×™×“×ª ××©×˜×¨×”" },
      { emoji: "ğŸšœ", en: "Tractor", he: "×˜×¨×§×˜×•×¨" },
      { emoji: "ğŸš²", en: "Bicycle", he: "××•×¤× ×™×™×" },
      { emoji: "ğŸ›´", en: "Kick Scooter", he: "×§×•×¨×§×™× ×˜" },
      { emoji: "ğŸš•", en: "Taxi", he: "××•× ×™×ª" },
    ]
  }
];

const MODES = [
  {
    id: "image-to-english",
    icon: "ğŸ–¼ï¸",
    nameHe: "×ª××•× ×” â† ××™×œ×” ×‘×× ×’×œ×™×ª",
    descHe: "×¨×•××™× ×ª××•× ×” ×•×‘×•×—×¨×™× ××ª ×”××™×œ×” ×”× ×›×•× ×” ×‘×× ×’×œ×™×ª",
  },
  {
    id: "english-to-hebrew",
    icon: "ğŸ‡¬ğŸ‡§",
    nameHe: "×× ×’×œ×™×ª â† ×¢×‘×¨×™×ª",
    descHe: "×¨×•××™× ××™×œ×” ×‘×× ×’×œ×™×ª ×•×‘×•×—×¨×™× ××ª ×”×ª×¨×’×•× ×‘×¢×‘×¨×™×ª",
  },
  {
    id: "hebrew-to-english",
    icon: "ğŸ‡®ğŸ‡±",
    nameHe: "×¢×‘×¨×™×ª â† ×× ×’×œ×™×ª",
    descHe: "×¨×•××™× ××™×œ×” ×‘×¢×‘×¨×™×ª ×•×‘×•×—×¨×™× ××ª ×”×ª×¨×’×•× ×‘×× ×’×œ×™×ª",
  },
];

const WORDS_PER_ROUND = 10;
const OPTIONS_COUNT = 4;
const ROUND_OPTIONS = [1, 3, 5];

// ============================================================
//  STATE
// ============================================================
let selectedTopic = null;
let selectedMode = null;
let selectedRounds = null;
let currentRound = 0;
let questionQueue = [];
let questionIndex = 0;
let totalQuestionsAnswered = 0;
let score = 0;
let correctCount = 0;
let isAnswered = false;

// ============================================================
//  TEXT-TO-SPEECH
// ============================================================
function speak(text, lang) {
  if (!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang === 'he' ? 'he-IL' : 'en-US';
  utter.rate = 0.85;
  utter.pitch = 1.1;
  window.speechSynthesis.speak(utter);
}

function speakEnglish(text) { speak(text, 'en'); }
function speakHebrew(text) { speak(text, 'he'); }

// ============================================================
//  WELCOME SCREEN SETUP
// ============================================================
function buildWelcome() {
  const topicGrid = document.getElementById('topic-grid');
  topicGrid.innerHTML = '';

  TOPICS.forEach(topic => {
    const card = document.createElement('div');
    card.className = 'topic-card';
    card.dataset.id = topic.id;
    card.innerHTML = `
      <button class="speaker-btn-mini" onclick="event.stopPropagation(); speakEnglish('${topic.nameEn}')" title="Listen">ğŸ”Š</button>
      <span class="topic-icon">${topic.icon}</span>
      <div class="topic-name-he">${topic.nameHe}</div>
      <div class="topic-name-en">${topic.nameEn}</div>
    `;
    card.addEventListener('click', () => selectTopic(topic.id));
    topicGrid.appendChild(card);
  });

  const modeGrid = document.getElementById('mode-grid');
  modeGrid.innerHTML = '';

  MODES.forEach(mode => {
    const card = document.createElement('div');
    card.className = 'mode-card';
    card.dataset.id = mode.id;
    card.innerHTML = `
      <span class="mode-icon">${mode.icon}</span>
      <div class="mode-info">
        <div class="mode-name">${mode.nameHe}</div>
        <div class="mode-desc">${mode.descHe}</div>
      </div>
    `;
    card.addEventListener('click', () => selectMode(mode.id));
    modeGrid.appendChild(card);
  });

  // Round selector
  const roundGrid = document.getElementById('round-grid');
  roundGrid.innerHTML = '';

  ROUND_OPTIONS.forEach(num => {
    const card = document.createElement('div');
    card.className = 'round-card';
    card.dataset.rounds = num;
    card.innerHTML = `
      <span class="round-number">${num}</span>
      <div class="round-label">${num === 1 ? '×¡×™×‘×•×‘' : '×¡×™×‘×•×‘×™×'}</div>
    `;
    card.addEventListener('click', () => selectRounds(num));
    roundGrid.appendChild(card);
  });
}

function selectTopic(id) {
  selectedTopic = id;
  document.querySelectorAll('.topic-card').forEach(c => {
    c.classList.toggle('selected', c.dataset.id === id);
  });
  updateStartBtn();
}

function selectMode(id) {
  selectedMode = id;
  document.querySelectorAll('.mode-card').forEach(c => {
    c.classList.toggle('selected', c.dataset.id === id);
  });
  updateStartBtn();
}

function selectRounds(num) {
  selectedRounds = num;
  document.querySelectorAll('.round-card').forEach(c => {
    c.classList.toggle('selected', parseInt(c.dataset.rounds) === num);
  });
  updateStartBtn();
}

function updateStartBtn() {
  document.getElementById('start-btn').disabled = !(selectedTopic && selectedMode && selectedRounds);
}

// ============================================================
//  GAME LOGIC
// ============================================================
function startGame() {
  if (!selectedTopic || !selectedMode || !selectedRounds) return;

  currentRound = 0;
  score = 0;
  correctCount = 0;
  totalQuestionsAnswered = 0;

  const topic = TOPICS.find(t => t.id === selectedTopic);
  const modeObj = MODES.find(m => m.id === selectedMode);
  document.getElementById('game-header-title').textContent =
    `${topic.icon} ${topic.nameHe} - ${modeObj.nameHe}`;
  document.getElementById('score').textContent = '0';

  showScreen('game-screen');
  startNextRound();
}

function startNextRound() {
  currentRound++;

  if (currentRound > selectedRounds) {
    showResults();
    return;
  }

  const topic = TOPICS.find(t => t.id === selectedTopic);
  const topicWords = [...topic.words];
  shuffleArray(topicWords);
  questionQueue = topicWords.slice(0, WORDS_PER_ROUND);
  questionIndex = 0;

  // Show round banner if more than 1 round
  if (selectedRounds > 1) {
    showRoundBanner(currentRound, selectedRounds, () => {
      showQuestion();
    });
  } else {
    showQuestion();
  }
}

function showRoundBanner(round, total, callback) {
  const banner = document.createElement('div');
  banner.className = 'round-banner';
  banner.innerHTML = `
    <div class="round-banner-content">
      <div class="round-banner-emoji">ğŸ</div>
      <div class="round-banner-title">×¡×™×‘×•×‘ ${round} ××ª×•×š ${total}</div>
      <div class="round-banner-sub">!×™××œ×œ×”</div>
    </div>
  `;
  document.body.appendChild(banner);
  setTimeout(() => {
    banner.remove();
    callback();
  }, 1500);
}

function showQuestion() {
  if (questionIndex >= questionQueue.length) {
    startNextRound();
    return;
  }

  isAnswered = false;
  const word = questionQueue[questionIndex];
  const topic = TOPICS.find(t => t.id === selectedTopic);
  const allWords = topic.words;

  // progress within current round
  const roundProgress = (questionIndex / questionQueue.length) * 100;
  document.getElementById('progress-bar').style.width = roundProgress + '%';
  document.getElementById('progress-text').textContent =
    `×©××œ×” ${questionIndex + 1} ××ª×•×š ${questionQueue.length}`;

  // round indicator
  if (selectedRounds > 1) {
    document.getElementById('round-text').textContent =
      `×¡×™×‘×•×‘ ${currentRound} ××ª×•×š ${selectedRounds}`;
  } else {
    document.getElementById('round-text').textContent = '';
  }

  // build distractors
  const distractors = allWords
    .filter(w => w.en !== word.en)
    .sort(() => Math.random() - 0.5)
    .slice(0, OPTIONS_COUNT - 1);
  const options = [...distractors, word];
  shuffleArray(options);

  const area = document.getElementById('question-area');
  area.innerHTML = '';

  // === PROMPT ===
  const promptCard = document.createElement('div');
  promptCard.className = 'prompt-card';

  if (selectedMode === 'image-to-english') {
    promptCard.innerHTML = `
      <span class="prompt-emoji">${word.emoji}</span>
      <div style="font-size:1.1em; color:var(--text-light);">?××” ×–×” ×‘×× ×’×œ×™×ª</div>
      <button class="speaker-btn" onclick="speakHebrew('${escapeQuotes(word.he)}')" title="×©××¢ ×‘×¢×‘×¨×™×ª">ğŸ”Š</button>
    `;
  } else if (selectedMode === 'english-to-hebrew') {
    promptCard.innerHTML = `
      <span class="prompt-emoji">${word.emoji}</span>
      <div class="prompt-word english">${word.en}</div>
      <div style="font-size:1.1em; color:var(--text-light); margin-top:5px;">?××” ×–×” ×‘×¢×‘×¨×™×ª</div>
      <button class="speaker-btn" onclick="speakEnglish('${escapeQuotes(word.en)}')" title="Listen in English">ğŸ”Š</button>
    `;
  } else {
    promptCard.innerHTML = `
      <span class="prompt-emoji">${word.emoji}</span>
      <div class="prompt-word hebrew">${word.he}</div>
      <div style="font-size:1.1em; color:var(--text-light); margin-top:5px;">?××” ×–×” ×‘×× ×’×œ×™×ª</div>
      <button class="speaker-btn" onclick="speakHebrew('${escapeQuotes(word.he)}')" title="×©××¢ ×‘×¢×‘×¨×™×ª">ğŸ”Š</button>
    `;
  }

  area.appendChild(promptCard);

  // auto-speak the prompt
  if (selectedMode === 'english-to-hebrew') {
    speakEnglish(word.en);
  } else if (selectedMode === 'hebrew-to-english') {
    speakHebrew(word.he);
  }

  // === OPTIONS ===
  const optGrid = document.createElement('div');
  optGrid.className = 'options-grid';

  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';

    if (selectedMode === 'image-to-english') {
      btn.innerHTML = `
        <button class="option-speaker" onclick="event.stopPropagation(); speakEnglish('${escapeQuotes(opt.en)}')" title="Listen">ğŸ”Š</button>
        <span class="option-emoji">${opt.emoji}</span>
        <span class="option-text english">${opt.en}</span>
      `;
    } else if (selectedMode === 'english-to-hebrew') {
      btn.innerHTML = `
        <button class="option-speaker" onclick="event.stopPropagation(); speakHebrew('${escapeQuotes(opt.he)}')" title="×©××¢">ğŸ”Š</button>
        <span class="option-text hebrew">${opt.he}</span>
      `;
    } else {
      btn.innerHTML = `
        <button class="option-speaker" onclick="event.stopPropagation(); speakEnglish('${escapeQuotes(opt.en)}')" title="Listen">ğŸ”Š</button>
        <span class="option-text english">${opt.en}</span>
      `;
    }

    btn.addEventListener('click', () => handleAnswer(btn, opt, word, optGrid));
    optGrid.appendChild(btn);
  });

  area.appendChild(optGrid);
}

function handleAnswer(btn, chosen, correct, optGrid) {
  if (isAnswered) return;
  isAnswered = true;

  const isCorrect = chosen.en === correct.en;
  const area = document.getElementById('question-area');
  totalQuestionsAnswered++;

  if (isCorrect) {
    btn.classList.add('correct');
    score += 10;
    correctCount++;
    document.getElementById('score').textContent = score;

    const fb = document.createElement('div');
    fb.className = 'feedback correct';
    fb.textContent = '!ğŸ‰ × ×›×•×Ÿ! ×›×œ ×”×›×‘×•×“';
    area.appendChild(fb);

    speakEnglish(correct.en);
  } else {
    btn.classList.add('wrong');
    // highlight the correct one
    optGrid.querySelectorAll('.option-btn').forEach(b => {
      const optText = b.querySelector('.option-text')?.textContent;
      const correctText = selectedMode === 'english-to-hebrew' ? correct.he : correct.en;
      if (optText === correctText) {
        b.classList.add('correct');
      }
    });

    const fb = document.createElement('div');
    fb.className = 'feedback wrong';
    fb.innerHTML = `×œ× × ×›×•×Ÿ ğŸ˜• ×”×ª×©×•×‘×” ×”× ×›×•× ×”: <strong>${correct.en}</strong> = <strong>${correct.he}</strong>`;
    area.appendChild(fb);

    speakEnglish(correct.en);

    // Re-add wrong answer to end of queue for another try
    questionQueue.push(correct);
  }

  setTimeout(() => {
    questionIndex++;
    showQuestion();
  }, 2000);
}

// ============================================================
//  RESULTS
// ============================================================
function showResults() {
  document.getElementById('progress-bar').style.width = '100%';

  const pct = totalQuestionsAnswered > 0 ? (correctCount / totalQuestionsAnswered) : 0;
  const starCount = pct >= 0.9 ? 3 : pct >= 0.7 ? 2 : pct >= 0.4 ? 1 : 0;

  let emoji = 'ğŸ‰';
  let title = '!××“×”×™×! ×›×œ ×”×›×‘×•×“';
  let subtitle = '××ª×” ×›×•×›×‘ ×‘×× ×’×œ×™×ª!';

  if (pct < 0.4) {
    emoji = 'ğŸ’ª';
    title = '!××œ ×ª×•×•×ª×¨';
    subtitle = '× ×¡×” ×©×•×‘, ××ª×” ×™×›×•×œ ×œ×¢×©×•×ª ××ª ×–×”!';
  } else if (pct < 0.7) {
    emoji = 'ğŸ˜Š';
    title = '!×œ× ×¨×¢';
    subtitle = '×›××¢×˜ ×©×, × ×¡×” ×©×•×‘!';
  } else if (pct < 0.9) {
    emoji = 'ğŸŒŸ';
    title = '!×™×•×¤×™';
    subtitle = '×¢×‘×•×“×” ××¦×•×™× ×ª!';
  }

  document.getElementById('results-emoji').textContent = emoji;
  document.getElementById('results-title').textContent = title;
  document.getElementById('results-subtitle').textContent = subtitle;
  document.getElementById('stat-correct').textContent = correctCount;
  document.getElementById('stat-total').textContent = totalQuestionsAnswered;

  const starsHtml = [1,2,3].map(i =>
    `<span class="star ${i <= starCount ? 'earned' : ''}" style="animation-delay: ${i * 0.2}s">â­</span>`
  ).join('');
  document.getElementById('stars-container').innerHTML = starsHtml;

  showScreen('results-screen');

  if (pct >= 0.7) {
    launchConfetti();
  }
}

function replayGame() {
  startGame();
}

function goHome() {
  showScreen('welcome-screen');
}

// ============================================================
//  UTILITIES
// ============================================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function escapeQuotes(str) {
  return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
}

function launchConfetti() {
  const container = document.getElementById('confetti-container');
  container.innerHTML = '';
  const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FDCB6E', '#6C5CE7', '#FF85A1', '#2ECC71'];

  for (let i = 0; i < 60; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + '%';
    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDelay = Math.random() * 2 + 's';
    piece.style.animationDuration = (2 + Math.random() * 2) + 's';
    piece.style.width = (6 + Math.random() * 8) + 'px';
    piece.style.height = (6 + Math.random() * 8) + 'px';
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    container.appendChild(piece);
  }

  setTimeout(() => { container.innerHTML = ''; }, 4000);
}

// ============================================================
//  INIT
// ============================================================
buildWelcome();
</script>
</body>
</html>
